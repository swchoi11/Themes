# Themes

## 소개
### 목적
* easy parser의 ocr, yolo기반 컴포넌트 감지 부분의 단점을 보완하기 위해 이미지의 xml 구조를 활용하여 컴포넌트 감지
* xml 파일에 있는 컴포넌트별 리소스 정보를 활용하여 rule based 이미지 처리 모듈 구현
* 제미나이를 활용한 이미지 처리 모듈의 기능 보완

### 수행기간
* 1차 베이스라인 구현 : 2025.05.27 ~ 2025.06.04
* 2차 고도화 : 2025.06.04 ~

## 개요
### 전제 조건
* 디폴트 또는 정상 테마의 파일이 레이블링되어 존재해야함 
* 이미지에 해당하는 xml파일이 함께 존재해야함

### 처리 과정

#### 1. classification

``1-1. default, pass 이미지에 대한 분류``

동일한 prefix가 붙은 이미지를 폴더링

``1-2. 동일한 prefix가 붙은 이미지에 대한 xml 유사도를 기반으로 한 분류``

#### 2. layout

``2-1. xml구조 안에서 이슈 모듈과 관련 있는 레이아웃인지 검증``

* 텍스트 컴포넌트가 있는지 -> 가독성 검증`(3-1)`
* 아이콘 컴포넌트가 있는지 -> 아이콘 잘림`(3-2)`, 정렬`(3-3)`, 중복 아이콘 검증`(3-4)`
* 다이얼 컴포넌트가 있는지 -> 전화 다이얼 버튼의 정렬 검증`(3-5)`
* 라디오박스, 체크박스 컴포넌트가 있는지 -> 아이콘 잘림`(3-2)` 검증

``2-2. 이미지별 이슈 모듈의 수행`` --> 3의 반복 수행

#### 3. issue

``3-1. 가독성 검증``
* 고채도, 저채도 사진 분류 
* 채도 분류에 맞는 색공간을 사용한(hsv 또는 lab) 주요 색상 추출
* 주요 색상이 3가지가 되지 않는 경우 클러스터링을 통한 색상 추출
* 3가지 색의 상호 비교를 통한 색 대비 검증 -> 1가지 조합만 유의미한 대비여도 ok

``3-2. 아이콘 잘림 이슈 검증``
* 사진의 캐니 변환을 통한 엣지 검출
* 엣지에서 직선 라인이 일정 길이 이상 검출되는지 확인
* 일정 길이 이상 검출되면 이상한 직선이 검출된 잘린 아이콘으로 검증

``3-3. 정렬 검증``
* 화면의 수평, 수직 길이의 절반 이하가 되는 컴포넌트만 추출 
* 해당 컴포넌트에 대한 포함 관계 정리
* 컴포넌트의 위치에 따른 수평 구간 추출 및 동일 구간에 대한 컴포넌트 그룹핑
* 그룹한 컴포넌트에 대한 거리 산출
* 동일 거리 구간을 가지고 있는지 검증

``3-4. 동일한 아이콘 검증``
* 화면에서 아이콘 크기의 컴포넌트만 추출
* 해당 컴포넌트와 동일한 이미지가 있는지 검증
* 동일한 이미지가 있다면 99% 이상 일치하는 정상 이미지 추출
* 정상 이미지에서도 동일한 이미지가 검출되는지 확인 -> 동일하다면 이슈 아님, 아니면 이슈

``3-5. 전화 다이얼 버튼에 대한 정렬 검증``
* 전화 다이얼 버튼이 있는 경우 화면을 3등분
* 해당 다이얼이 3등분한 구간 안에 존재하는지 검증

#### 4. gemini

``4-1. 달력 아이콘에 요일 글자가 테두리를 벗어났는지``

``4-2. 달력 아이콘의 날짜 글자가 상단바의 요일 정보와 다른지``

``4-3. 시계 아이콘에서 시간 아이콘이 상단의 시간 정보와 다른지``

``4-4. 상호작용 요소에 대한 가독성 이슈의 추가 검증``

#### 5. 종합 및 결과 산출

``5-1. 제미나이를 활용한 추출된 이슈의 심각도에 따른 정렬 및 정리``






## 폴더 구조
```
.
├── README.md
├── output
│   ├── com.android.intentresolver_ChooserActivityLauncher
│   │   ├── group_0
│   │   │   ├── theme1_image_1.png
│   │   │   └── theme1_image_1.xml
│   │   └── group_1
│   │   │   ├── theme1_image_2.png
│   │   │   └── theme1_image_2.xml
│   └── com.android.settings_MainActivity
│       ├── group_0
│       │   ├── theme2_image_1.png
│       │   └── theme2_image_1.xml
│       └── group_1
│           ├── theme2_image_2.png
│           ├── theme2_image_2.xml
│           ├── theme3_image_1.png
│           └── theme3_image_1.xml
├── common
│   ├── config.py
│   ├── logger.py
│   └── prompt.py
├── src
│   ├── issue
│   │   ├── alignment.py
│   │   ├── cutoff.py
│   │   ├── icon.py
│   │   └── visibility.py
│   ├── classification.py
│   ├── detect.py
│   ├── gemini.py
│   ├── layout.py
│   ├── match.py
│   ├── model.py
│   ├── utils.py
│   └── visualize.py
└── main.py
```